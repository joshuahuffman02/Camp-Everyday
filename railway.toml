[build]
# Force Docker builds instead of Railpack to support pnpm workspaces
builder = "DOCKERFILE"
# Web service uses Dockerfile.web (API service overrides this in platform/apps/api/railway.toml)
dockerfilePath = "Dockerfile.web"

# Cache pnpm store between builds for faster installs
buildCacheMounts = ["/root/.local/share/pnpm/store"]

# Pass these environment variables as Docker build arguments
buildArgs = [
  "NEXT_PUBLIC_API_BASE",
  "AUTH_URL",
  "AUTH_SECRET",
  "AUTH_TRUST_HOST",
  "CACHE_BUST"
]

[deploy]
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

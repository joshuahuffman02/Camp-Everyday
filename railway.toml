[build]
# Force Docker builds instead of Railpack to support pnpm workspaces
builder = "DOCKERFILE"
# NOTE: dockerfilePath is set per-service in Railway dashboard
# - Web service: Dockerfile.web
# - API service: Dockerfile.api

# Cache pnpm store between builds for faster installs
buildCacheMounts = ["/root/.local/share/pnpm/store"]

# Pass these environment variables as Docker build arguments
buildArgs = [
  "NEXT_PUBLIC_API_BASE",
  "AUTH_URL",
  "AUTH_SECRET",
  "AUTH_TRUST_HOST",
  "CACHE_BUST"
]

[deploy]
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

# Railway configuration for the Web service (@keepr/web)
# This is the SINGLE SOURCE OF TRUTH for web builds

[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile.web"
rootDirectory = "."

# CRITICAL: Pass environment variables as Docker build arguments
# These are required for Next.js to bake in the correct API URLs at build time
buildArgs = [
  "NEXT_PUBLIC_API_BASE",
  "AUTH_URL",
  "AUTH_SECRET",
  "AUTH_TRUST_HOST"
]

# Watch paths - only rebuild when these files change
watchPatterns = [
  "/platform/apps/web/**",
  "/platform/packages/shared/**",
  "/Dockerfile.web",
  "/content/**"
]

[deploy]
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
